<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rinnana | #MSG_commu</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="overlay">
        <div class="overlay-content">
            <div class="overlay-title">
                <img src="images/icon1.png" class="overlay-icon rotate-right">
                魔法四季学園
                <img src="images/icon2.png" class="overlay-icon rotate-left">
            </div>
            <div class="overlay-subtitle">Mahoushiki Gakuen | #MSG_commu</div>
            <button class="enter-btn" onclick="startSite()">ENTER SITE</button>
        </div>
    </div>

    <audio id="main-audio" loop><source id="audio-source" src="music/sukisugi_vocal.mp3" type="audio/mp3"></audio>

    <div class="music-controls" id="music-container">
        <span id="track-label" class="track-info">Vocal Ver.</span>
        <button id="play-btn" class="icon-btn"><img id="play-img" src="images/pause.png" alt="Play/Pause"></button>
    </div>

    <nav class="navbar">
        <div class="navbar-container">
            <ul class="navbar-menu">
                <li><a href="index.html" class="nav-link active">Character</a></li>
                <li><a href="gallery.html" class="nav-link">Gallery</a></li>
                <li><a href="ost.html" class="nav-link">OST/Voice</a></li>
                <li><a href="story.html" class="nav-link">Story</a></li>
            </ul>
        </div>
    </nav>

    <div id="app-content">
        <header class="hero">
            <img src="images/hero.jpg" alt="Hero Image" class="hero-img">
            <div class="hero-desc">เว็บไซต์นี้จัดทำขึ้นเพื่อรวบรวมเรื่องราวของเด็กสาวทั้งสองในเซ็ตติ้ง Mohoushiki Gakuen หรือ #MSG_commu<br>ตัวละครและเนื้อหาทั้งหมดเป็นเพียงเรื่องสมมติที่สร้างขึ้นเพื่อความบันเทิง</div>
        </header>

        <main>
            <section class="character-container">
                <div class="char-title" style="color:var(--pink-light)">Character</div>
                <div class="char-sub">東雲 凛 - Shinonome Rin (ชิโนโนเมะ ริน)</div>
                <div class="profile-grid">
                    <div class="idcard-wrapper">
                        <div class="idcard-inner"><img src="images/idcard1.jpg" class="idcard-front"><img src="images/idcard1_back.jpg" class="idcard-back"></div>
                    </div>
                    <div class="sheet-wrapper">
                        <div class="section-label" style="color:var(--pink-light)">Character Sheet</div>
                        <div class="hover-lift-container"><img src="images/sheet1.jpg" class="img-base"><img src="images/sheet1_back.jpg" class="img-hover"></div>
                    </div>
                </div>
                <div class="wand-full-width">
                    <div class="section-label" style="color:var(--pink-light)">WAND</div>
                    <div class="hover-lift-container"><img src="images/wand1.jpg" class="img-base"><img src="images/wand1_back.png" class="img-hover"></div>
                    <div class="credit-text" style="color:var(--pink-light)">ออกแบบโดย Reverie Silver</div>
                </div>
            </section>

            <hr style="border: 0; border-top: 1px solid #eee; max-width: 1400px; margin: 0 auto;">

            <section class="character-container" style="padding-top: 80px;">
                <div class="char-title" style="color:var(--blue-theme)">Character</div>
                <div class="char-sub">姓 名 - Hirabayashi Naoe (ฮิราบายาชิ นาโอเอะ)</div>
                <div class="profile-grid">
                    <div class="idcard-wrapper">
                        <div class="idcard-inner"><img src="images/idcard2.jpg" class="idcard-front"><img src="images/idcard2_back.jpg" class="idcard-back"></div>
                    </div>
                    <div class="sheet-wrapper">
                        <div class="section-label" style="color:var(--blue-theme)">Character Sheet</div>
                        <div class="hover-lift-container"><img src="images/sheet2.jpg" class="img-base"><img src="images/sheet2_back.jpg" class="img-hover"></div>
                    </div>
                </div>
                <div class="wand-full-width">
                    <div class="section-label" style="color:var(--blue-theme)">CANE</div>
                    <div class="hover-lift-container"><img src="images/wand2.jpg" class="img-base"><img src="images/wand2_back.jpg" class="img-hover"></div>
                    <div class="credit-text" style="color:var(--blue-theme)">ออกแบบโดย Reverie Silver</div>
                </div>
            </section>

            <div class="icon-divider"><img src="images/icon1.png" class="rotate-right"><img src="images/icon2.png" class="rotate-left"></div>

            <section class="chat-section">
                <div class="chat-bubbles">
                    <div class="bubble bubble-pink"><img src="images/char1.png" class="bubble-avatar"><div class="bg-pink">ยัตต้า!</div></div>
                    <div class="bubble bubble-blue"><img src="images/char2.png" class="bubble-avatar"><div class="bg-blue">คิก- เก่งมากเลยค่ะ</div></div>
                </div>
            </section>
            <div class="music-credit">BGM: <b>Sukisugi - Natsuki Karin</b> (Lyrics by Tianpasa)</div>
        </main>
    </div>

    <script>
        const audio = document.getElementById('main-audio');
        const source = document.getElementById('audio-source');
        const playBtn = document.getElementById('play-btn');
        const playImg = document.getElementById('play-img');
        const musicContainer = document.getElementById('music-container');
        const label = document.getElementById('track-label');
        const overlay = document.getElementById('overlay');
        let isVocal = true;

        if(audio) audio.volume = 0.3;

        function startSite() {
            if(audio) audio.play().catch(e => console.log("Audio Error"));
            updatePlayBtn();
            if(overlay) {
                overlay.style.opacity = '0';
                overlay.style.visibility = 'hidden';
                document.body.style.overflow = 'auto'; 
                setTimeout(() => overlay.remove(), 800);
            }
        }

        function updatePlayBtn() { if(playImg) playImg.src = audio.paused ? "images/play.png" : "images/pause.png"; }

        if(musicContainer) {
            musicContainer.addEventListener('click', (e) => {
                if (e.target.closest('#play-btn')) return;
                const currentTime = audio.currentTime;
                isVocal = !isVocal;
                source.src = isVocal ? "music/sukisugi_vocal.mp3" : "music/sukisugi_off.mp3";
                label.innerText = isVocal ? "Vocal Ver." : "Off Vocal";
                musicContainer.style.backgroundColor = isVocal ? "#FFF7E6" : "#6FCCD9";
                audio.load(); audio.currentTime = currentTime; audio.play();
                updatePlayBtn();
            });
        }

        if(playBtn) {
            playBtn.addEventListener('click', (e) => { e.stopPropagation(); if (audio.paused) audio.play(); else audio.pause(); updatePlayBtn(); });
        }

        function setupAnimations() {
            const flipCards = document.querySelectorAll('.idcard-wrapper');
            const liftCards = document.querySelectorAll('.hover-lift-container');
            const isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            if (isTouch) {
                flipCards.forEach(el => el.addEventListener('click', function() { this.classList.toggle('is-flipped'); }));
                liftCards.forEach(el => el.addEventListener('click', function() { this.classList.toggle('is-lifted'); }));
            }
        }

        const sheetCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTq0BFHKVSCUHbzjS-GPCLoggKXpeAecEMsj9yn4lZArfBZk6I6RzxfuM88cos9ifd2UGJdKguUX_w4/pub?output=csv"; 
        async function loadGallery() {
            const grid = document.getElementById('galleryGrid');
            if (!grid) return;
            try {
                const response = await fetch(sheetCsvUrl + "&t=" + new Date().getTime());
                const data = await response.text();
                const rows = data.split('\n').slice(1); 
                grid.innerHTML = ''; 
                rows.forEach(row => {
                    if (row.trim() === '') return; 
                    const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (columns.length >= 2) {
                        const artist = columns[0].replace(/^"|"$/g, '').trim();
                        const url = columns[1].replace(/^"|"$/g, '').trim();
                        if(url && url.startsWith('http')) {
                            const item = document.createElement('div');
                            item.className = 'gallery-item';
                            item.innerHTML = `
                                <img src="${url}" alt="Artwork by ${artist}" onerror="this.src='https://placehold.co/400x600?text=Image+Error'">
                                <div class="artist-tag">By <span class="artist-name">${artist}</span></div>
                            `;
                            grid.appendChild(item);
                        }
                    }
                });
            } catch (error) { 
                grid.innerHTML = '<p>ไม่สามารถดึงข้อมูลรูปภาพได้</p>'; 
            }
        }

        document.addEventListener('click', e => {
            const link = e.target.closest('.nav-link');
            if (link) {
                e.preventDefault();
                const url = link.getAttribute('href');
                if (url && url !== "#") loadPage(url);
            }
        });

        async function loadPage(url) {
            const content = document.querySelector('#app-content');
            if(!content) return;
            content.classList.add('page-loading');
            await new Promise(r => setTimeout(r, 400));
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error("Fetch failed");
                const html = await res.text();
                const doc = new DOMParser().parseFromString(html, 'text/html');
                const newContent = doc.querySelector('#app-content');
                if (newContent) {
                    content.innerHTML = newContent.innerHTML;
                    window.history.pushState({}, '', url);
                    document.querySelectorAll('.nav-link').forEach(l => {
                        l.classList.remove('active');
                        if (url.includes(l.getAttribute('href'))) l.classList.add('active');
                    });
                    document.body.style.overflow = 'auto';
                    if (url.includes('gallery.html')) loadGallery();
                    if (url.includes('index.html')) setupAnimations();
                    content.classList.remove('page-loading');
                    window.scrollTo(0, 0);
                } else {
                    window.location.href = url;
                }
            } catch (err) { 
                window.location.href = url; 
            }
        }

        setupAnimations();
        window.onpopstate = () => loadPage(window.location.href);
    </script>
</body>
</html>